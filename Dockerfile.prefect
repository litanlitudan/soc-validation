# Custom Prefect Server image with aiosqlite support
FROM prefecthq/prefect:3-python3.12

# Install curl for health checks and aiosqlite for async SQLite support
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/* && \
    pip install --no-cache-dir aiosqlite

# Copy initialization script
COPY scripts/init_prefect.py /app/init_prefect.py
RUN chmod +x /app/init_prefect.py

# Use the initialization script as the command
CMD ["python", "/app/init_prefect.py"]